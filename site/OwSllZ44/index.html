<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>Неприкосновенна</title>

        <!-- Иконка -->
        <link
            rel="icon"
            href="./images/НЕПРИКОСНОВЕННА.jpg"
            type="image/x-icon"
        />
        <link
            rel="shortcut icon"
            href="./images/НЕПРИКОСНОВЕННА.jpg"
            type="image/x-icon"
        />

        <link rel="stylesheet" href="./css/style.css" />
        <link rel="stylesheet" href="./css/cursor.css" />
    </head>

    <body>
        <img
            id="img-cursor"
            class="z-6"
            src="./images/icons8-3d-pointer-50_1.png"
            alt="icon"
        />
        <div id="div-photo">
            <div id="div-flash-3" class="div-flash z-3 d-none">
                <img
                    id="img-flash-3"
                    class="img-flash not-allowed-image"
                    src="./images/05.jpg"
                    alt="ВСПЫШКА"
                />
            </div>
            <div id="div-flash-2" class="div-flash z-3 d-none">
                <img
                    id="img-flash-2"
                    class="img-flash not-allowed-image"
                    src="./images/04.jpg"
                    alt="ВСПЫШКА"
                />
            </div>
            <div id="div-flash-1" class="div-flash z-3 d-none">
                <img
                    id="img-flash-1"
                    class="img-flash not-allowed-image"
                    src="./images/01_2.jpg"
                    alt="ВСПЫШКА"
                />
            </div>
            <div id="div-flash-0" class="div-flash z-3 d-none">
                <div id="div-flash-0-back" class="div-flash"></div>
            </div>
            <button id="btn-click" class="z-2" onclick="clickButton()" disabled>
                неприкосновенна
            </button>
            <img
                id="img-portrait"
                class="not-allowed-image z-1"
                src="./images/НЕПРИКОСНОВЕННА.png"
                alt="НЕПРИКОСНОВЕННА"
            />
        </div>
    </body>

    <style>
        :root {
            cursor: default;
            --font-size: x-small;
        }

        /* 
    
    
    */

        .div-flash {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            border-radius: 7.5px;
        }

        .img-flash {
            width: auto;
            align-self: center;
            position: absolute;
            border-radius: 7.5px;
        }

        #div-flash-0 {
            mix-blend-mode: exclusion;
            /* mix-blend-mode: plus-lighter; */
        }

        #div-flash-0-back {
            background-color: lemonchiffon;
            width: 99.5%;
            height: 98.5%;
            margin: 0.2%;
        }

        #div-flash-1 {
            mix-blend-mode: normal;
        }

        #div-flash-2 {
            mix-blend-mode: normal;
        }

        #div-flash-3 {
            mix-blend-mode: normal;
        }

        #img-flash-1 {
            height: 112%;
            top: -4.5%;
            left: -52%;
        }

        #img-flash-2 {
            height: 228%;
            top: -29%;
            left: -64%;
        }

        #img-flash-3 {
            height: 141%;
            top: 50%;
            left: 52%;
            align-self: center;
            transform: translate(-50%, -50%);
        }

        /* Класс для резкой анимации вспышки */
        .flash-animation {
            animation: sharpFlash 0.15s cubic-bezier(0.4, 0, 0.6, 1);
        }

        @keyframes sharpFlash {
            0% {
                opacity: 0;
            }
            20% {
                opacity: 1; /* Быстро появляется */
            }
            40% {
                opacity: 0.8; /* Немного спадает */
            }
            60% {
                opacity: 1; /* Второй пик */
            }
            80% {
                opacity: 0.4; /* Быстро угасает */
            }
            100% {
                opacity: 0; /* Полное исчезновение */
            }
        }

        /*  
    

        */

        #div-photo {
            position: absolute;
            width: 60vw;
            height: auto;
            display: block;
            margin: 0;
            align-self: center;
        }

        #img-portrait {
            position: relative;
            width: 100%;
            height: auto;
            cursor: none;
            opacity: 1;
            border-radius: 7.5px;
        }

        #btn-click {
            position: absolute;
            top: 75%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: none;
            font-size: var(--font-size);
        }

        @media (min-width: 768px) {
            #div-photo {
                width: 50vw;
            }
        }

        @media (min-width: 1024px) {
            #div-photo {
                width: 35vw;
            }
        }

        @media (min-width: 1280px) {
            #div-photo {
                width: 30vw;
            }
        }

        @media (min-width: 1440px) {
            #div-photo {
                width: 30vw;
            }
        }

        @media (min-width: 1600px) {
            #div-photo {
                width: 25vw;
            }
        }

        @media (min-width: 1920px) {
            #div-photo {
                width: 25vw;
            }
        }
    </style>

    <script src="/src/jquery-3.7.1.min.js"></script>
    <script type="text/javascript">
        $("body").hide();
        $(document).ready(function () {
            $("body").show();
        });

        window.addEventListener("beforeunload", function (event) {
            event.returnValue = "Уверены, что хотите покинуть страницу?";
            return event.returnValue;
        });

        //
        //
        //

        // Настройки физики движения
        const settings = {
            stiffness: 0.4, // Жесткость пружины (скорость реакции)
            damping: 0.97, // Затухание (плавность остановки)
            mass: 0.1, // Масса объекта
            // maxSpeed: 0.1, // Максимальная скорость
            maxSpeed: 15, // Максимальная скорость
        };

        // Задержка до включения курсора
        const TIMEOUT = 1;

        //
        //
        //

        const ELEMENT_CURSOR = $("#img-cursor");

        const Zone = {
            NONE: 0,
            PHOTO: 1,
            BUTTON: 2,
        };

        var CurrentZone = Zone.NONE;

        function updateCurrentZone() {
            if (isPosInElementBoundary($("#btn-click"))) {
                if (CurrentZone != Zone.BUTTON) {
                    changeSrc(
                        ELEMENT_CURSOR,
                        "./images/icons8-hand-cursor-48_1.png",
                    );
                    CurrentZone = Zone.BUTTON;
                    $("#btn-click").attr("disabled", false);
                }
            } else if (isPosInElementBoundary($("#img-portrait"))) {
                if (CurrentZone != Zone.PHOTO) {
                    changeSrc(
                        ELEMENT_CURSOR,
                        "./images/icons8-unavailable-48.png",
                    );
                    CurrentZone = Zone.PHOTO;
                    $("#btn-click").attr("disabled", true);
                }
            } else {
                if (CurrentZone != Zone.NONE) {
                    changeSrc(
                        ELEMENT_CURSOR,
                        "./images/icons8-3d-pointer-50_1.png",
                    );
                    CurrentZone = Zone.NONE;
                    $("#btn-click").attr("disabled", true);
                }
            }
        }

        //
        //
        //

        // const element = document.getElementById('img-portrait');
        // element.addEventListener('mousedown', function(e) {
        //     if (e.which === 1) { // 1 - левая кнопка
        //         if (CurrentZone == Zone.PHOTO)
        //             number = getRandomInt(1, 4)
        //             flash([number, 0, number, 0, number, number, number]);
        //     }
        // });

        const LIMIT_CLICK = getRandomInt(40, 50);
        var countClick = 0;

        function clickButton() {
            countClick += 1;
            if (countClick > LIMIT_CLICK) {
                const LINK = "010m62QKkgdYxQ";
                window.open(`./${LINK}.html`, "_blank");
            } else {
                let number = getRandomInt(1, 4);
                flash([number, 0, number, 0, number, number, number]);
            }
        }

        function flash(ids) {
            if (ids.length <= 0) return;

            const $flash = $("#div-flash-" + ids[0].toString());
            // if (ids[0] == 0)
            //     $('#div-flash-0-back').css("background-color", getRandomColor());

            // Сбрасываем предыдущую анимацию
            $flash.removeClass("flash-animation");
            void $flash[0].offsetWidth; // Триггер перерисовки

            // Показываем и запускаем анимацию
            $flash.show();
            $flash.addClass("flash-animation");

            // Скрываем после завершения анимации
            setTimeout(() => {
                $flash.removeClass("flash-animation");
                $flash.hide();
                ids.shift();
                flash(ids);
            }, 150); // Длительность анимации
        }

        function getRandomColor() {
            var letters = "0123456789ABCDEF";
            var color = "#";
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min) + min);
        }
    </script>
    <script src="./js/cursorController.js"></script>
</html>
