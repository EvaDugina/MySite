<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>–ù–µ–ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–Ω–∞</title>

        <link
            rel="icon"
            href="./images/–û–ü–õ–û–î–û–¢–í–û–†–ï–ù–ò–ï_LOD2.jpg"
            type="image/x-icon"
        />
        <link
            rel="shortcut icon"
            href="./images/–û–ü–õ–û–î–û–¢–í–û–†–ï–ù–ò–ï_LOD2.jpg"
            type="image/x-icon"
        />

        <link rel="stylesheet" href="./css/style.css" />
        <link rel="stylesheet" href="./css/flash.css" />
        <link rel="stylesheet" href="./css/cursor.css" />
    </head>

    <body>
        <img
            id="img-cursor"
            class="img-cursor not-allowed z-6"
            src="./images/default.png"
            alt="icon"
        />
        <div id="div-photo" class="div-photo">
            <div id="div-flash-4" class="div-flash z-3 d-none">
                <img
                    id="img-flash-4"
                    class="img-flash not-allowed"
                    src="./images/–£–ö–†–ê–õ–ò.jpg"
                    alt="–£–ö–†–ê–õ–ò"
                />
            </div>
            <div id="div-flash-3" class="div-flash z-3 d-none">
                <img
                    id="img-flash-3"
                    class="img-flash not-allowed"
                    src="./images/–û–ü–õ–û–î–û–¢–í–û–†–ï–ù–ò–ï.jpg"
                    alt="–û–ü–õ–û–î–û–¢–í–û–†–ï–ù–ò–ï"
                />
            </div>
            <div id="div-flash-2" class="div-flash z-3 d-none">
                <img
                    id="img-flash-2"
                    class="img-flash not-allowed"
                    src="./images/04.jpg"
                    alt="–í–°–ü–´–®–ö–ê"
                />
            </div>
            <div id="div-flash-1" class="div-flash z-3 d-none">
                <img
                    id="img-flash-1"
                    class="img-flash"
                    src="./images/01_2.jpg"
                    alt="–í–°–ü–´–®–ö–ê"
                />
            </div>
            <div id="div-flash-0" class="div-flash z-3 d-none">
                <div id="div-flash-0-back" class="div-flash"></div>
            </div>
            <div id="div-point" class="div-point z-3"></div>
            <button id="btn-click" class="btn-click not-allowed z-4">
                –Ω–µ–ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–Ω–∞
            </button>
            <img
                id="img-portrait"
                class="img-portrait not-allowed z-1"
                src="./images/–ù–ï–ü–†–ò–ö–û–°–ù–û–í–ï–ù–ù–ê.png"
                alt="–ù–ï–ü–†–ò–ö–û–°–ù–û–í–ï–ù–ù–ê"
            />
            <video
                id="video"
                class="img-portrait z-1 d-none"
                poster="./images/–ù–ï–ü–†–ò–ö–û–°–ù–û–í–ï–ù–ù–ê.png"
                preload="auto"
                loop
            >
                <source src="./videos/–õ–ò–ó–ê –ü–õ–ê–ß–ï–¢.webm" type="video/webm" />
                <source src="./videos/–õ–ò–ó–ê –ü–õ–ê–ß–ï–¢.mp4" type="video/mp4" />
            </video>
        </div>
    </body>

    <style>
        #div-flash-0 {
            mix-blend-mode: exclusion;
        }

        #div-flash-0-back {
            background-color: lemonchiffon;
            width: 99.5%;
            height: 98.5%;
            margin: 0.2%;
        }

        #img-flash-1 {
            height: 112%;
            top: -4.5%;
            left: -52%;
        }

        #img-flash-2 {
            height: 228%;
            top: -29%;
            left: -64%;
        }

        #img-flash-3 {
            height: 116%;
            top: -5%;
            left: -88%;
        }

        #img-flash-4 {
            height: 141%;
            top: 50%;
            left: 52%;
            align-self: center;
            transform: translate(-50%, -50%);
        }

        /*


        */

        #div-photo {
            width: 40%;
        }

        #video {
        }

        #btn-click {
            top: 75%;
            left: 50%;
            font-size: var(--font-size-sm);
        }

        #div-point {
            position: absolute;
            top: 75%;
            left: 55%;
            width: 8px;
            height: 8px;
            display: block;
            margin: 0;
            align-self: center;
            background-color: red;
            opacity: 0;
            transform: translate(-50%, -50%);
        }

        @media (min-width: 768px) {
            #div-photo {
                width: 35%;
            }
        }

        @media (min-width: 1024px) {
            #div-photo {
                width: 30%;
            }
        }

        @media (min-width: 1280px) {
            #div-photo {
                width: 25%;
            }
        }

        @media (min-width: 1440px) {
            #div-photo {
                width: 25%;
            }
        }

        @media (min-width: 1600px) {
            #div-photo {
                width: 20%;
            }
        }

        @media (min-width: 1920px) {
            #div-photo {
                width: 20%;
            }
        }
    </style>

    <script src="/src/jquery-3.7.1.min.js"></script>
    <script src="./js/optimization.js"></script>
    <script src="./js/links/index.js"></script>
    <script type="text/javascript">
        //
        // CURSOR MOVE CONTROLL
        //

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ cursorController
        const SETTINGS = {
            elementCursor: $("#img-cursor"), // –û–±—ä–µ–∫—Ç –∫—É—Ä—Å–æ—Ä–∞
            timeout: 2, // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º
            startX: 0.9, // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –æ—Ç width –ø–æ X
            startY: 0.25, // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –æ—Ç —Ä—É—à–ø—Ä–µ –ø–æ Y
            stiffness: 0.4, // –ñ–µ—Å—Ç–∫–æ—Å—Ç—å –ø—Ä—É–∂–∏–Ω—ã (—Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–∞–∫—Ü–∏–∏)
            damping: 0.97, // –ó–∞—Ç—É—Ö–∞–Ω–∏–µ (–ø–ª–∞–≤–Ω–æ—Å—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫–∏)
            mass: 0.1, // –ú–∞—Å—Å–∞ –æ–±—ä–µ–∫—Ç–∞
            // maxSpeed: 0.1, // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
            maxSpeed: 2.5, // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
        };

        const Zone = {
            NONE: 0,
            PHOTO: 1,
            BUTTON: 2,
            POINT: 3,
        };

        const $IMG_PORTRAIT = $("#img-portrait");
        const $VIDEO = $("#video");
        const $BUTTON = $("#btn-click");

        const ZONES_SETTINGS = {
            [Zone.NONE]: {
                element: null,
                imgCursor: "./images/default.png",
                handleOn: null,
                handleOff: null,
            },
            [Zone.PHOTO]: {
                element: $IMG_PORTRAIT,
                imgCursor: "./images/default.png",
                handleOn: null,
                handleOff: null,
            },
            [Zone.BUTTON]: {
                element: $BUTTON,
                imgCursor: "./images/pointer.png",
                handleOn: cursorOnButton,
                handleOff: cursorOffButton,
            },
            [Zone.POINT]: {
                element: $("#div-point"),
                imgCursor: null,
                handleOn: null,
                handleOff: null,
            },
        };

        function cursorOnButton() {
            $BUTTON.addClass("hovered");
            $BUTTON.css("pointer-events", "all");
        }

        function cursorOffButton() {
            $BUTTON.removeClass("hovered");
            $BUTTON.css("pointer-events", "none");
        }

        //
        // CURSOR CLICK CONTROLL
        //

        var countClick = 0;
        var IS_CLICKED = false;

        async function handleClick(e) {
            if (e.which === 1) {
                if (!isCursorZone(Zone.POINT) && !isCursorZone(Zone.BUTTON))
                    return;

                if (IS_CLICKED) return;

                IS_CLICKED = true;
                countClick += 1;

                if (isCursorZone(Zone.POINT)) {
                    await clickPoint();
                } else if (isCursorZone(Zone.BUTTON)) {
                    await clickButton();
                }

                IS_CLICKED = false;
            }
        }

        async function clickPoint() {
            $BUTTON.css("pointer-events", "none");
            $BUTTON.attr("disabled", true);
            disableCursor();
            stopCursor();

            switchSources();

            $BUTTON.addClass("d-none");
            await flash(generateFlashArray(3));
            await flash(generateFlashArray(3));
            $BUTTON.removeClass("d-none");

            $BUTTON.removeClass("hovered");
            $BUTTON.removeClass("active");
            $BUTTON.attr("disabled", true);

            setTimeout(() => {
                playVideo();
            }, 400);

            // setTimeout(() => {
            //     qwerty();
            // }, 2000);
        }

        async function clickButton() {
            $BUTTON.addClass("active");
            number = getRandomInt(1, 2);
            flash([number, 0, number, 0, number, number, number]);

            setTimeout(() => {
                $BUTTON.removeClass("active");
            }, 500);
        }

        async function switchSources() {
            $VIDEO.removeClass("d-none");
            $IMG_PORTRAIT.addClass("d-none");
        }

        //
        // FLASH CONTROLL
        //

        const FLASH_SETTINGS = {
            duration: 150,
        };

        function generateFlashArray(number) {
            return [number, 0, number, 0, number, number, number];
        }

        //
        // VIDEO CONTROLL
        //

        const VIDEO = $VIDEO[0];

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
        function playVideo() {
            VIDEO.play()
                .then(() => {
                    console.log("‚úÖ –í–∏–¥–µ–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è");
                })
                .catch((error) => {
                    console.error(
                        "‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:",
                        error.name,
                        error.message,
                    );

                    // –ï—Å–ª–∏ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ, –ø—Ä–æ–±—É–µ–º —Å muted
                    if (error.name === "NotAllowedError") {
                        console.log("–ü—Ä–æ–±—É—é –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å muted...");
                        VIDEO.muted = true;
                        VIDEO.play().catch((e) => {
                            console.error("–î–∞–∂–µ —Å muted –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å:", e);
                        });
                    }
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—É–∑—ã
        function pauseVideo() {
            VIDEO.pause();
            console.log("‚è∏Ô∏è –í–∏–¥–µ–æ –Ω–∞ –ø–∞—É–∑–µ");
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
        function stopVideo() {
            VIDEO.pause();
            VIDEO.currentTime = 0;
            console.log("‚èπÔ∏è –í–∏–¥–µ–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ");
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–æ—Ç–∫–∏
        function seekVideo(seconds) {
            VIDEO.currentTime = seconds;
            console.log(`‚è© –ü–µ—Ä–µ–º–æ—Ç–∫–∞ –Ω–∞ ${seconds} —Å–µ–∫—É–Ω–¥`);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ
        function loadVideo(src) {
            // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
            $VIDEO.find("source").remove();

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫
            $VIDEO.append(`<source src="${src}" type="video/webm">`);

            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç
            video.load();

            console.log(`üìÅ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ: ${src}`);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∏–¥–µ–æ
        function getVideoState() {
            return {
                paused: video.paused,
                currentTime: video.currentTime,
                duration: video.duration,
                ended: video.ended,
                volume: video.volume,
                muted: video.muted,
                readyState: video.readyState,
            };
        }
    </script>
    <script src="./js/cursorController.js"></script>
    <script src="./js/flash.js"></script>
    <script src="./js/random.js"></script>
</html>
